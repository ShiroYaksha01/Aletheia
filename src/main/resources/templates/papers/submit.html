<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/index}">
<head>
    <title>Submit New Paper</title>
</head>
<body>

    <div layout:fragment="content">
<form th:action="${editMode} ? @{|/papers/${paperId}/edit|} : @{/papers/create}"
      method="post"
      th:object="${paperRequest}"
      enctype="multipart/form-data"
      novalidate
      class="max-w-3xl space-y-8">
            
            <div class="glass-card rounded-xl p-6 space-y-6">
                <h2 class="text-lg font-semibold text-white">Paper Information</h2>
                
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-200">Paper Title *</label>
                    <input type="text" th:field="*{title}" class="w-full bg-[#020817] border border-gray-800 rounded-md p-2 text-white" placeholder="Enter paper title" required>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-200">Abstract *</label>
                    <textarea th:field="*{abstractText}" rows="4" class="w-full bg-[#020817] border border-gray-800 rounded-md p-2 text-white" placeholder="Brief summary of your research..." required></textarea>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-200">Research Area *</label>
                    
                    <select id="researchAreaSelect" th:field="*{researchArea}" class="w-full bg-[#020817] border border-gray-800 rounded-md p-2 text-white" required onchange="toggleOtherInput()">
                        <option value="" disabled selected>Select an area</option>
                        <option value="AI">Artificial Intelligence</option>
                        <option value="ML">Machine Learning</option>
                        <option value="CS">Cybersecurity</option>
                        <option value="DS">Data Science</option>
                        <option value="SE">Software Engineering</option>
                        <option value="OTHER">Other</option>
                    </select>

                    <div id="otherAreaContainer" class="hidden mt-3 transition-all duration-300">
                        <label class="text-sm font-medium text-gray-200">Please specify area *</label>
                        <input type="text" id="customAreaInput" name="customResearchArea" class="w-full mt-1 bg-[#020817] border border-gray-800 rounded-md p-2 text-white" placeholder="Enter your specific research area">
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-xl p-6 space-y-4">
                <h2 class="text-lg font-semibold text-white">Paper File</h2>

                <div class="border-2 border-dashed border-gray-800 rounded-lg p-8 text-center hover:border-teal-500/50 transition-colors">

                    <!-- Show existing file in edit mode -->
                    <div th:if="${editMode} and ${paperRequest.fileName != null}">
                        <p class="text-sm text-gray-300">
                            Current file: 
                            <a th:href="@{'/papers/files/' + ${paperRequest.fileName}}" target="_blank"
                            class="text-teal-400 hover:underline"
                            th:text="${paperRequest.fileName}">PDF</a>
                        </p>
                    </div>

                    <!-- File input (optional in edit mode) -->
                    <input type="file" name="file" accept=".pdf"
                        th:attr="required=${!editMode}"
                        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 
                                file:rounded-full file:border-0 file:text-sm file:font-semibold 
                                file:bg-teal-500/10 file:text-teal-500 hover:file:bg-teal-500/20" />

                    <p class="text-xs text-gray-500 mt-2"
                    th:text="${editMode} ? 'Upload new PDF to replace existing (optional)' : 'PDF only, max 10MB'">
                    </p>
                </div>
            </div>


            <div class="flex justify-end gap-4">
                <a th:href="@{/dashboard}" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</a>
                <button type="submit"
                        th:text="${editMode} ? 'Update Paper' : 'Submit Paper'"
                        class="px-6 py-2 bg-gradient-to-r from-teal-600 to-blue-600 text-white rounded-lg font-medium">
                </button>

            </div>
        </form>

        <script>
            function toggleOtherInput() {
                const select = document.getElementById('researchAreaSelect');
                const otherContainer = document.getElementById('otherAreaContainer');
                const customInput = document.getElementById('customAreaInput');

                if (select.value === 'OTHER') {
                    otherContainer.classList.remove('hidden');
                    customInput.required = true; // Make it required if "Other" is selected
                } else {
                    otherContainer.classList.add('hidden');
                    customInput.required = false; // Not required otherwise
                    customInput.value = ''; // Clear input if hidden
                }
            }
        </script>
    </div>

</body>
</html>